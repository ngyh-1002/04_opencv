-----

# 번호판 추출기 (License Plate Extractor)

이 파이썬 스크립트는 **OpenCV**를 사용하여 이미지에서 번호판을 대화형으로 추출하고 보정합니다. 이미지에서 번호판의 네 모서리를 클릭하기만 하면, 스크립트는 \*\*원근 변환(perspective transformation)\*\*을 수행하여 원근 왜곡을 수정하고 번호판이 정면에서 보는 것처럼 보이게 합니다. 추출된 번호판은 별도의 이미지 파일로 저장됩니다.

-----

## 주요 기능

  * **대화형 지점 선택**: 이미지에서 네 개의 점을 클릭하여 관심 영역(예: 번호판)을 정의합니다.
  * **원근 변환**: 선택된 영역의 원근 왜곡을 자동으로 보정하여 직사각형의 곧게 펴진 이미지를 출력합니다.
  * **자동 저장**: 추출된 번호판을 전용 디렉터리(`extracted_plates/`)에 고유한 타임스탬프 및 순번이 있는 파일 이름으로 저장합니다.
  * **실시간 시각화**: 클릭한 점이 표시된 원본 이미지와 최종 추출된 번호판을 모두 표시합니다.

-----

## 작동 방식: 원근 변환

이 스크립트의 핵심은 **원근 변환**(`cv2.getPerspectiveTransform` 및 `cv2.warpPerspective`)을 사용하는 것입니다. 간단히 설명하면 다음과 같습니다:

1.  **입력 지점**: 사용자가 입력 이미지에서 왜곡된 번호판의 모서리를 정의하는 네 개의 점(`pts1`)을 제공합니다. 스크립트는 사용자의 클릭 순서와 상관없이 이 점들이 **좌상단, 우상단, 우하단, 좌하단** 모서리를 정확하게 나타내도록 자동으로 순서를 재정렬합니다.
2.  **출력 지점**: 원하는 출력 이미지에 대한 네 개의 해당 지점(`pts2`)이 정의됩니다. 이 지점들은 완벽한 직사각형(예: `[0,0]`, `[width-1,0]`, `[width-1,height-1]`, `[0,height-1]`)을 형성하며, 곧게 펴진 번호판의 모서리를 나타냅니다.
3.  **변환 행렬 계산**: `cv2.getPerspectiveTransform`은 3x3 **변환 행렬**을 계산합니다. 이 행렬은 입력 이미지의 왜곡된 사각형(정의된 `pts1`에 의해)에서 모든 픽셀을 곧게 펴진 출력 공간(정의된 `pts2`에 의해)의 해당 픽셀로 매핑하는 방법을 수학적으로 설명합니다.
4.  **변환 적용**: `cv2.warpPerspective`는 이 계산된 변환 행렬을 전체 입력 이미지에 적용합니다. 이는 `pts1`로 지정된 영역의 왜곡을 "풀고" `pts2` 사각형에 투영하여 번호판을 표준 300x150 픽셀 이미지로 효과적으로 곧게 펴줍니다. 입력 이미지에서 정의된 사각형 외부의 픽셀은 일반적으로 출력에서 검은색으로 설정되거나 무시되며, 보정된 영역에만 초점을 맞춥니다.

이 과정은 자동 번호판 인식(ALPR)과 같은 작업에서 매우 중요합니다. 번호판의 표준화되고 명확한 이미지를 제공하여 후속 문자 인식 단계를 단순화하기 때문입니다.

-----

## 시작하기

### 전제 조건

  * Python 3.x
  * OpenCV 라이브러리 (`opencv-python`)
  * NumPy 라이브러리 (`numpy`)

### 설치

1.  이 저장소를 클론하거나 제공된 코드를 파이썬 파일(예: `extract_plate.py`)로 저장하세요.
2.  필요한 라이브러리를 설치합니다:
    ```bash
    pip install opencv-python numpy
    ```

### 사용법

1.  입력 이미지(예: `car_05.jpg`)를 스크립트와 동일한 레벨에 있는 `img` 디렉터리 안에 배치합니다 (예: `your_project/img/car_05.jpg`).
2.  터미널에서 스크립트를 실행합니다:
    ```bash
    python extract_plate.py
    ```
3.  "License Plate Extractor"라는 제목의 창에 이미지가 나타납니다.
4.  이미지에서 번호판의 **네 모서리를 클릭**하세요. 클릭한 위치에 녹색 원이 나타납니다.
5.  네 번째 클릭 후, "Extracted Plate"라는 새 창에 곧게 펴진 번호판이 표시됩니다. 추출된 이미지는 `extracted_plates/` 디렉터리에도 저장됩니다.
6.  아무 키나 누르면 모든 창이 닫히고 스크립트가 종료됩니다.

# 차량 번호판 이미지 전처리 (OpenCV)

이 프로젝트는 **OpenCV**를 사용하여 **추출된 차량 번호판 이미지를 전처리**하는 파이프라인입니다. 번호판의 글자를 명확하게 식별하고, 이후 글자 인식 단계의 성능을 높이는 것이 목표입니다.

---

## 주요 이미지 처리 단계

1.  **그레이스케일 변환**: 컬러 이미지를 **흑백(그레이스케일)**으로 변환하여 처리 과정을 단순화합니다.
2.  **대비 극대화**: 번호판 글자의 가독성을 높이기 위해 **이미지의 대비를 선명하게** 만듭니다. 'Top Hat', 'Black Hat'과 같은 모폴로지 연산과 히스토그램 평활화 기법을 활용합니다.
3.  **적응형 이진화**: 그레이스케일 이미지를 **흑백 이진 이미지**로 변환합니다. 번호판마다 조명 조건이 다를 수 있으므로, 이미지의 특정 영역에 맞춰 임계값을 자동으로 조정하는 **적응형 이진화** 방식을 사용합니다.
4.  **윤곽선 검출 및 분석**: 이진화된 이미지에서 **글자처럼 보이는 영역(윤곽선)**을 찾아냅니다. 검출된 윤곽선을 시각화하고, 각 윤곽선의 면적이나 크기 비율 같은 기본적인 정보를 분석하여 잠재적인 글자 후보를 평가합니다.

---

## 사용 방법

스크립트 실행 시 `extracted_plates` 폴더에 있는 번호판 이미지를 자동으로 처리합니다. 각 처리 단계마다 Matplotlib 창이 뜨면서 결과를 시각적으로 보여주므로, 다음 단계로 넘어가려면 창을 수동으로 닫아야 합니다. 처리된 모든 이미지의 중간 결과와 최종 윤곽선 이미지는 `processed_plates` 폴더에 저장됩니다.

---

---

### OpenCV 이미지 변환 요약

* **이미지 이동(Translation)**: `cv2.warpAffine()` 함수와 2x3 **변환 행렬**로 픽셀 좌표를 평행 이동.
* **이미지 확대/축소(Scaling)**:
    * `cv2.warpAffine()`과 2x3 **변환 행렬** 사용.
    * 더 쉽게는 `cv2.resize()` 함수로 **크기 또는 배율 지정**.
* **이미지 회전(Rotation)**:
    * `cv2.warpAffine()`과 2x3 **변환 행렬** 사용.
    * 더 쉽게는 `cv2.getRotationMatrix2D()`로 회전 행렬을 얻어 적용.

---
---

### OpenCV 이미지 뒤틀기 요약 (단답형)

* **어핀 변환 (Affine Transform)**:
    * **개념**: 2차원 뒤틀기 (평행선 유지, 비율 보존).
    * **함수**: `cv2.getAffineTransform()` (3점 사용)으로 행렬 생성 후 `cv2.warpAffine()` 적용.
* **원근 변환 (Perspective Transform)**:
    * **개념**: 3차원 뒤틀기 (원근감 적용, 평행선 불유지).
    * **함수**: `cv2.getPerspectiveTransform()` (4점 사용)으로 행렬 생성 후 `cv2.warpPerspective()` 적용.
    * **주요 활용**: 원근감 있는 이미지를 평면처럼 스캔.
* **삼각형 어핀 변환**:
    * **개념**: 특정 삼각형 영역만 어핀 변환 후 합성하는 복잡한 과정.
    * **활용**: `cv2.boundingRect()`, `cv2.fillConvexPoly()`, `cv2.bitwise_and` 등 여러 함수 조합.

---
---

### OpenCV 필터 및 블러링 요약 (단답형)

* **필터/컨볼루션**:
    * **개념**: 커널(필터, 윈도, 마스크)을 이용해 주변 픽셀 값과 연산하여 새 픽셀 값을 얻는 공간 영역 필터링.
    * **핵심 연산**: 컨볼루션.
    * **OpenCV 함수**: `cv2.filter2D()`.
* **평균 블러링 (Average Blurring)**:
    * **개념**: 커널 내 픽셀들의 **평균값**으로 대체하여 영상을 흐릿하게 함.
    * **OpenCV 함수**: `cv2.blur()`, `cv2.boxFilter()`.
* **가우시안 블러링 (Gaussian Blurring)**:
    * **개념**: **가우시안 분포(정규 분포)**를 따르는 커널을 적용. 중앙 픽셀에 가중치를 더 많이 줘 노이즈 제거에 효과적.
    * **OpenCV 함수**: `cv2.GaussianBlur()`, `cv2.getGaussianKernel()` (커널 생성).
* **미디언 블러링 (Median Blurring)**:
    * **개념**: 커널 내 픽셀들의 **중앙값**으로 대체. **소금-후추 잡음** 제거에 탁월.
    * **OpenCV 함수**: `cv2.medianBlur()`.
* **바이레터럴 필터 (Bilateral Filter)**:
    * **개념**: 노이즈 제거와 동시에 **경계선을 보존**하는 필터. 가우시안 필터와 경계 필터 결합.
    * **특징**: 효과는 좋지만 처리 속도가 느림.
    * **OpenCV 함수**: `cv2.bilateralFilter()`.

---
---

### OpenCV 경계 검출 필터 요약 (단답형)

* **경계 검출 개념**: 픽셀 값의 급격한 변화 지점(엣지)을 찾아 이미지를 선명하게(샤프닝) 하는 작업.
* **기본 미분 필터**:
    * **개념**: 인접 픽셀 값 차이를 이용한 1차 미분 근사.
    * **특징**: x방향(세로 엣지), y방향(가로 엣지) 검출.
* **로버츠 교차 필터**:
    * **개념**: 대각선 방향 1차 미분 근사.
    * **특징**: 사선 경계 검출 강화, 노이즈에 민감.
* **프리윗 필터**:
    * **개념**: x, y축 각 방향으로 3번 차분 계산.
    * **특징**: 상하/좌우 경계 검출에 강함, 대각선에 약함.
* **소벨 필터**:
    * **개념**: 중심 픽셀의 차분 비중을 2배로 준 1차 미분 필터.
    * **특징**: x, y, 대각선 모든 방향 경계 검출에 강하며 실무에 많이 사용.
    * **OpenCV 함수**: `cv2.Sobel()`.
* **샤르 필터**:
    * **개념**: 소벨 필터의 중심부 정확도 개선.
    * **특징**: 소벨보다 엣지 방향성 정확도 높음.
    * **OpenCV 함수**: `cv2.Scharr()`.
* **라플라시안 필터**:
    * **개념**: **2차 미분** 적용 필터.
    * **특징**: 경계 강조 효과 뛰어남.
    * **OpenCV 함수**: `cv2.Laplacian()`.
* **캐니 엣지 (Canny Edge)**:
    * **개념**: 노이즈 제거, 그레디언트 계산, 비최대치 억제, 이력 스레시홀딩의 **4단계 알고리즘**.
    * **특징**: 가장 널리 사용되고 정확한 엣지 검출기.
    * **OpenCV 함수**: `cv2.Canny()`.

---
---

### OpenCV 모폴로지(Morphology) 연산 요약 (단답형)

* **모폴로지 연산**:
    * **개념**: 바이너리(흑백) 이미지의 형태학적 연산 (노이즈 제거, 구멍 채우기 등).
    * **핵심**: 0과 1로 구성된 **구조화 요소 커널(Structuring Element Kernel)** 사용.
    * **커널 생성 함수**: `cv2.getStructuringElement()`.
* **침식 (Erosion)**:
    * **개념**: 이미지의 **전경(밝은 영역)**을 깎아내거나 축소.
    * **효과**: 작은 노이즈 제거, 개체 분리, 선 가늘게 하기.
    * **OpenCV 함수**: `cv2.erode()`.
* **팽창 (Dilation)**:
    * **개념**: 이미지의 **전경(밝은 영역)**을 확장하거나 채우기.
    * **효과**: 끊어진 선 연결, 구멍 메우기, 노이즈 제거 (어두운 노이즈).
    * **OpenCV 함수**: `cv2.dilate()`.
* **열림 (Opening)**:
    * **개념**: **침식 후 팽창** (노이즈 제거하며 원본 형태 유지).
    * **효과**: 밝은 노이즈 제거, 돌출부 제거, 개체 분리.
    * **OpenCV 함수**: `cv2.morphologyEx(..., cv2.MORPH_OPEN, ...)`.
* **닫힘 (Closing)**:
    * **개념**: **팽창 후 침식** (노이즈 제거하며 원본 형태 유지).
    * **효과**: 어두운 노이즈 제거, 끊어진 선 연결, 구멍 메우기.
    * **OpenCV 함수**: `cv2.morphologyEx(..., cv2.MORPH_CLOSE, ...)`.
* **그레디언트 (Gradient)**:
    * **개념**: **팽창 연산 결과에서 침식 연산 결과를 뺀 것**.
    * **효과**: 이미지의 **경계선**만 추출 (경계 검출과 유사).
    * **OpenCV 함수**: `cv2.morphologyEx(..., cv2.MORPH_GRADIENT, ...)`.
* **탑햇 (Top Hat)**:
    * **개념**: **원본 이미지에서 열림 연산 결과를 뺀 것**.
    * **효과**: 원본보다 **밝은 영역 중 돌출된 부분**을 강조 (원본에서 사라진 밝은 부분).
    * **OpenCV 함수**: `cv2.morphologyEx(..., cv2.MORPH_TOPHAT, ...)`.
* **블랙햇 (Black Hat)**:
    * **개념**: **닫힘 연산 결과에서 원본 이미지를 뺀 것**.
    * **효과**: 원본보다 **어두운 영역 중 오목하게 들어간 부분**을 강조 (닫힘 연산으로 채워진 어두운 부분).
    * **OpenCV 함수**: `cv2.morphologyEx(..., cv2.MORPH_BLACKHAT, ...)`.

---
